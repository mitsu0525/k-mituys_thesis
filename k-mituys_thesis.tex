\documentclass[a4paper,11pt]{jarticle}
\usepackage{ics-thesis}
\usepackage{amssymb}
\usepackage[dvipdfmx]{graphicx}
\usepackage{subfig}
\graphicspath{{./figures/}}
\captionsetup[subfigure]{subrefformat=simple,labelformat=simple,listofformat=subsimple}
\renewcommand\thesubfigure{(\alph{subfigure})}
\usepackage{svg}
\setsvg{inkscapepath=../figures/}
\svgpath{{./figures/}}
\usepackage{amsmath}
\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argmax}{argmax}
\usepackage{algorithm, algpseudocode}
\usepackage{here}
\pagestyle{bachelorthesis}
%
\title{多様な端末が混在する無線LANにおけるベイズ最適化を用いた\\アクセスポイント制御方式}
\author{光安 海}
\supervisor{若宮 直紀 教授}
\deadline{2019年2月12日}
%
\begin{document}
\titlepage    % 規定の.styファイルを使う場合
\abstract     % 規定の.styファイルを使う場合
%%%%%%%%%%%%%%%%%%%%%
% 内容梗概本文
%%%%%%%%%%%%%%%%%%%%%
% 研究背景と目的．やったこと．その結果．
無線技術の高速化や無線機器の低コスト化にともない，IEEE802.11無線LANの普及が加速している．
企業内や公共施設などにおいて，複数の無線アクセスポイント(AP)をサービス提供領域に敷設し無線接続サービスを提供することもあたりまえになってきた．

一方で，無線LANに接続可能な機器も増加するだけではなく，トラヒック特性や機器の性能，制御方式などの異なる端末が同一の無線LAN環境内で混在するような状況になってきている．しかしながら，多様な端末が混在すると，期待された性能を得られない状況が生じ得る．

そこで本報告では，多様な端末が混在する無線LAN環境において，ベイズ最適化を用いたAP制御方式を提案する．提案方式では，APによる制御と端末間の挙動の応答関係を不明なものとして扱う．そのもとで，ブラックボックス関数の最適化に用いられるベイズ最適化を適用することで，少ない試行回数でスループットを向上させるアクセスポイント制御方式を実現する．
またシミュレーションを行い，提案方式は既存のチャネル割当方式と比べて，高い確率でスループットが良くなることを示した．
\keyword
%%%%%%%%%%%%%%%%%%%%%
% キーワード
%%%%%%%%%%%%%%%%%%%%%
無線LAN，アクセスポイント制御，チャネル割当，ベイズ最適化
\tableofcontents    % 目次
%
%%%%%%%%%%%%%%%%%%%%%
% 本文
%%%%%%%%%%%%%%%%%%%%%
%
\section{はじめに}
無線技術の高速化や無線機器の低コスト化にともない，IEEE802.11無線LAN\cite{ieee802.11}の普及が加速している．
企業内や公共施設などにおいて，複数の無線アクセスポイント(AP)をサービス提供領域に敷設し無線接続サービスを提供することもあたりまえになってきた．

一方で，無線LANに接続可能な機器も増加するだけではなく，トラヒック特性や機器の性能，制御方式などの異なる端末が同一の無線LAN環境内で混在するような状況になってきている．
例えば，
% (具体例を挙げて説明する)
端末はアクセスポイントの電波強度などの情報を用いて接続先APを選択するが，特定のAPに接続が集中して，そのAPに接続する端末のスループットが低下するなどの問題が起こりうる．

一方で，複数のAPが敷設された無線LAN環境においては，チャネル制御\cite{channel_assign}や送信電力制御\cite{Chaves2014}によってAPや端末における干渉を軽減することでスループットを向上させている．
% (引用した方式の説明をその方式のポイントを抑えながら説明する)
\cite{channel_assign}では，無線LANのチャネル割当を重み付きグラフ彩色問題として定式化し，最適化することでAP間の干渉を削減している．
\cite{Chaves2014}では，各端末が利用可能なModulation and Coding Scheme (MCS)のうち通信レートが最大のものを使用するための閾値を超えるSignal-to-Interface-plus-Noise Ratio (SINR)を求め，そのSINRを達成する必要最低限の送信電力になるように制御を行う．その結果，高密度無線LANにおいて端末ごとの平均スループットの向上を達成している．

しかしながら，多様な端末が混在すると，以上のような方式は端末の振る舞いの違いにより期待された性能を得られない状況が生じ得る．

したがって，そのような状況において，無線LAN環境全体の性能を改善するためには，APと端末の双方が協調した制御を行うことが必要である．しかしながら，以上のような多様な端末が混在する環境においては，そのような方式の実現は難しい．それは多様な端末が存在することや今後新たな端末が現れることを考えると，全ての端末に制御方式を実装するのは難しいからである．そのため，端末の性能や種類，および要求品質などの違いに依存しない，制御方式が必要である．

そこで本報告では，多様な端末が混在する無線LAN環境において，ベイズ最適化を用いたAP制御方式を提案する．提案方式では，APによる制御と端末間の挙動の応答関係を不明なものとして扱う．そのもとで，ブラックボックス関数の最適化に用いられるベイズ最適化を適用することで，少ない試行回数でスループットを向上させるアクセスポイント制御方式を実現する．
具体的には，
% (具体的に提案方式の特徴を適切に説明する)
APの使用するチャネルを決めるチャネル割当と，端末の接続先APを決めるAP割当をベイズ最適化の入力とし，無線LANの合計スループットをベイズ最適化の出力とする．チャネル割当とAP割当のベイズ最適化を段階的に行うことにより，少ない試行回数でスループットを最適値に近づける．

% どんな環境で提案方式を評価して何を示すか具体的に書く．
複数のAPで構成される無線LANに，AP選択アルゴリズムの異なる2種類の端末が複数混在する環境において，無線LANの合計スループットを既存のチャネル割当方式と比較し，その有効性を評価する．

\section{ベイズ最適化}
% ベイズ最適化を，ここを読むだけで理解できるように書いてください．
% 少なくとも，ベイズ最適化の構成要素である
% ・ガウス過程による回帰
% ・カーネル
% ・獲得関数(いろんな獲得関数含め)

% 加えて，できれば
% ・ベイズ最適化の課題と改良方式(整数の取り扱いやら，高次元対応など)

ベイズ最適化は，ブラックボックス関数$f(\mathbf{x})$を確率過程とみなし，ベイズ推論を用いて解候補の試行を逐次的に行うことで，関数$f(\mathbf{x})$を最大にする入力$\mathbf{x}^* = \argmax_{\mathbf{x}} f(\mathbf{x})$を求める手法である．

ベイズ最適化では，ブラックボックス関数の事前分布がガウス過程に従うと仮定し，$t$回の試行で得られた既知のデータ$D_{1:t}=\{\mathbf{x}_{1:t},f(\mathbf{x}_{1:t})\}$に基づき，ベイズの定理により事後分布を求める．
得られた事後分布に基づき，探索(不確実性が高い範囲での試行)と活用(改善が見込める範囲での試行)のトレードオフを調整する獲得関数を最大化することで
，次に試行する点$\mathbf{x}_{t+1}$を決定する．
新たな試行により得られたデータを含めて事後分布を再計算し，試行を繰り返すことで$f(\mathbf{x})$を最大にする点に収束する．

ベイズ最適化はグリッドサーチ法と比べて，効率良く計算できるため，計算コストが高い機械学習のハイパーパラメータ探索などに用いられる．

\subsection{ガウス過程による回帰}
ベイズ最適化では，ブラックボックス関数$f(\mathbf{x})$の事前分布が式(\ref{gaussian})のようにガウス過程に従うと仮定するのが一般的である．

\begin{equation}
  f(\mathbf{x})\sim N(m(\mathbf{x}),k(x, x^{'})) \label{gaussian}
\end{equation}

ただし，$N(\mu,\sigma^2)$は平均と分散を$\mu, \sigma$とする正規分布であり，$m(\mathbf{x})$と$k(x, x^{'}$は$\mathbf{x}$における平均とカーネル関数を表している．

既知のデータを$D_{1:t}=\{\mathbf{x}_{1:t},f(\mathbf{x}_{1:t})\}$とすると，関数$f(\mathbf{x})$の事後分布は式(\ref{posterior})で定義される．

\begin{equation}
  P(f|D_{1:t})\propto P(D_{1:t}|f)P(f) \label{posterior}
\end{equation}

事後分布$P(f|D_{1:t})$から得られる平均と分散を用いて獲得関数を最大化することで，次に試行する点$\mathbf{x}_{t+1}$を決定する．

\subsection{獲得関数}
獲得関数は，ベイズ最適化において次に試行する点を決める役割を担っている．使用する獲得関数とそのパラメータによって探索と活用のバランスが変わる．
以下にベイズ最適化で使用される獲得関数の例を3つ挙げる．

$i$回目に試行した点を$\mathbf{x}_i$，目的関数の値を$f(\mathbf{x}_i)$とする．
ここでは，目的関数を最大化することを考え，$t$回の試行における最大値を$f(\mathbf{x}^+)$で表す．
ただし，$\mathbf{x}^+ = \argmax_{\mathbf{x}_i \in \mathbf{x}_{1:t}} f(\mathbf{x}_i)$である．

\subsubsection{Probability of Improvement (PI)}
$f(\mathbf{x})$が$f(\mathbf{x}^+)$より改善される確率PIは，探索と活用のトレードオフを制御するパラメータ$\xi\geq0$を導入して式(\ref{PI})で求められる．
\begin{equation}
  \text{PI}(\mathbf{x})=\Phi \left(\frac{\mu(\mathbf{x})-f(\mathbf{x}^+)-\xi}{\sigma(\mathbf{x})}\right) \label{PI}
\end{equation}
$\Phi(・)$は正規累積分布関数，$\mu(・)$と$\sigma(・)$はそれぞれガウス過程から得られた平均と分散を表している．

PIでは，パラメータ$\xi$によってgreedyの度合いを緩和しているが，それでも局所的最適解に陥りやすい．

\subsubsection{Expected Improvement (EI)}
$f(\mathbf{x})$が$f(\mathbf{x}^+)$より改善される期待値EIは，探索と活用のトレードオフを制御するパラメータ$\xi\geq0$導入して式(\ref{EI})で求められる．
\begin{equation}
  \text{EI}(\mathbf{x}) = \left \{
  \begin{array}{ll}
    (\mu(\mathbf{x})-f(\mathbf{x}^+)-\xi)\Phi(Z) + \sigma(\mathbf{x})\phi(Z) & (\sigma(\mathbf{x}) > 0) \\
    0 & (\sigma(\mathbf{x}) = 0) \label{EI}
  \end{array}
  \right.
\end{equation}
ただし，
$$
  Z = \left \{
  \begin{array}{ll}
    \frac{\mu(\mathbf{x})-f(\mathbf{x}^+)-\xi}{\sigma(\mathbf{x})} & (\sigma(\mathbf{x}) > 0) \\
    0 & (\sigma(\mathbf{x}) = 0)
  \end{array}
  \right.
$$
$\phi(・)$と$\Phi(・)$はそれぞれ標準正規分布の確率密度関数と累積分布関数を表している．
$\xi=0.01$だとうまくいきやすい\cite{Lizotte:2008:PBO:1626686}．

\subsubsection{Gaussian Process Upper Confidence Bound (GP-UCB)}
ガウス過程で回帰した関数$f(\mathbf{x})$の信頼上限は，探索の重きを調整するパラメータ$\nu$を導入して式(\ref{UCB})で求められる．

\begin{equation}
  \text{GP-UCB}(\mathbf{x})=\mu(\mathbf{x})+\sqrt{\nu\tau_t}\sigma(\mathbf{x}) \label{UCB}
\end{equation}
ただし，
$$\tau_t=2\log\left(\frac{t^{\frac{d}{2}+2}\pi^2}{3\delta}\right)$$

$\delta$は開区間(0,1)の任意の実数，$d$は$\mathbf{x}$の次元数である．
1-$\delta$以上の確率で最適値に収束するが保証されている\cite{Srinivas}．

\subsection{ベイズ最適化の課題}
ベイズ最適化の回帰に用いるガウス過程は入力が連続である関数を想定しているため，離散値である整数を扱うとき丸める処理を行う．
そのため，入力を丸めることで同じ点の試行を繰り返すという問題が発生する．整数の入力に対応するために文献\cite{Garrido-Merchan2018}が提案されている．
% 文献\cite{Garrido-Merchan2018}では，ガウス過程のカーネルへの入力を整数に丸めることで事後分布が

また，ベイズ最適化の入力の次元数が増えたときに獲得関数が鋭いピーク持つようになり，獲得関数の最大化が困難になる．この問題への解決案として文献\cite{pmlr-v70-rana17a}が提案されている．
% 文献\cite{pmlr-v70-rana17a}では，

\section{ベイズ最適化を用いたアクセスポイント制御方式}
% まず，提案方式のアイディアと全体像を示す．そのもとで個々について説明する．を基本としてください．
アクセスポイントが制御できる要素であるチャネル割当とアクセスポイント割当を入力$\mathbf{x}$とし，
無線LANの合計スループットを目的関数$f(\mathbf{x})$とする．
ベイズ最適化を用いて，目的関数$f(\mathbf{x})$を最大にする入力
$\argmax_{\mathbf{x}} f(\mathbf{x})$を求める．
これにより無線LANの合計スループットを最大にするチャネル割当とアクセスポイント割当を得る．

ベイズ最適化の計算は無線LANの全アクセスポイントに接続するコントローラで行う．
% 提案手法の概念図は図\ref{conception_diagram}である．
コントローラがベイズ最適化を用いて得たチャネル割当とアクセスポイント割当をアクセスポイントに送り，アクセスポイントが計算した無線LANの合計スループットをコントローラに送る．

\subsection{入力の形式}
チャネル割当とアクセスポイント割当を目的関数の入力として扱うために，
アクセスポイントが利用できるチャネルと端末が利用できるアクセスポイントにそれぞれラベルを付ける．
% つまり，アクセスポイントの台数を$a$，端末の台数を$s$，チャネル数を$c$とすると，
% 目的関数への入力$\mathbf{x}={\mathbf{x}_a,\mathbf{x}_s}$
このとき，目的関数への入力の次元数は$(アクセスポイント台数+端末台数)$となる．

% ベイズ最適化へ整数を入力するとき，ガウス過程による回帰が連続を想定しているため，実質同じ点の試行を行うという問題が起きる．この問題をガウス過程に使用するカーネルへの入力を整数に丸めることで解決する\cite{Garrido-Merchan2018}．

\subsection{チャネル割当とAP割当のベイズ最適化}
アクセスポイントのチャネル割当を変える頻度を減らすために，チャネル割当のベイズ最適化$BO_{ch}$の中でアクセスポイント割当のベイズ最適化$BO_{ap}$を行う．フローチャートは図\ref{control_flow}である．
あるチャネル割当のもとでの最適なアクセスポイント割当をベイズ最適化を用いて求める．求めたアクセスポイント割当のもとでの最適なチャネル割当をベイズ最適化を用いて決める．これらを繰り返し行い，最適なチャネル割当とアクセスポイント割当を得る．

$BO_{ch}$の終了条件はイテレーションが最大イテレーションを超えたときであり，$BO_{ap}$の終了条件は直近10回の試行で最良値が更新されないときである．

\begin{figure}[t]
  \centering
  \includegraphics[width=15cm]{control_flow.pdf}
  \caption{提案手法のフローチャート}
  \label{control_flow}
\end{figure}

\section{シミュレーション評価}

\subsection{簡易スループットモデル}
スループットの計算には，隠れ端末とさらし端末の数から解析的に求める簡易スループットモデル\cite{Wu2000}を用いる．
ネットワークの端末$i$のスループット$\eta_i$は式(\ref{model})で求められる．ただし，$s$は使用できるチャネル数，$m_i$は端末$i$の隠れ端末の台数，$m_i$は端末$i$のさらし端末の台数である．
\begin{equation}
  \eta_i=\frac{s}{m_i+1}e^{-\frac{2n_i}{m_i+1}} \label{model}
\end{equation}
端末数が$n$である無線LANの合計スループットは式(\ref{total_throughput})で求められる．
\begin{equation}
  S_n=\sum_{k=0}^{n}\eta_k \label{total_throughput}
\end{equation}

\subsection{シミュレーション環境および設定}
ベイズ最適化を実行する無線LANは図\ref{position}である．
アクセスポイントの位置は固定で，端末は少なくとも一台のアクセスポイントと接続できる位置にランダムに配置される．無線LANとベイズ最適化のパラメータはそれぞれ表\ref{network_parameter}と表\ref{bayes_parameter}である．

\begin{figure}[t]
  \centering
  \includesvg[width=10cm]{network-random-50.svg}
  \caption{アクセスポイントと端末の配置図}
  \label{position}
\end{figure}

\begin{table}[H]
\centering
\caption{無線LANのパラメータ}
\begin{tabular}{l|lll}
パラメータ & 値 &  &  \\ \cline{1-2}
アクセスポイント台数 & 4 (台)  &  &  \\
端末台数 & 50 (台) &  &  \\
チャネル数 & 2 &  &  \\
通信可能距離  & 30 &  &  \\
干渉距離 & 45 &  &  \\
\end{tabular}
\label{network_parameter}
\end{table}

\begin{table}[H]
\centering
\caption{ベイズ最適化のパラメータ}
\begin{tabular}{l|lll}
パラメータ & 値 &  &  \\ \cline{1-2}
獲得関数 & EI ($\xi=0.01$)&  &  \\
カーネル & Matern 5/2 &  &  \\
最大イテレーション & 500 (回) &  & \\
\end{tabular}
\label{bayes_parameter}
\end{table}

また，端末に適用するアクセスポイント選択アルゴリズムを以下に示す．
アルゴリズム1は実際によく使われている．アルゴリズム2は一定以上のスループットを必要とする端末を想定している．今回の実験では，アルゴリズム1の端末とアルゴリズム2の端末を$1:1$の比率で混在させ，アルゴリズム2の閾値を0.06に設定している．

\begin{description}
  \item[アルゴリズム1]最も電波強度が高いアクセスポイントに接続
  \item[アルゴリズム2]スループットが閾値以下のとき接続先アクセスポイントを変更
\end{description}

\subsection{評価指標}
比較手法として隣り合うAPには異なるチャネルを割り当てる方式と比較する．
評価指標は無線LANの端末の上下スループットの合計である合計スループットとし，提案手法の有効性を評価する．


\subsection{シミュレーション結果}
実験の結果は図\ref{histogram}である．
図\ref{histogram}は100回の実験を行なったとき最終的に得られたスループットの最良値のヒストグラムである．
図\ref{histogram}の赤い線は比較手法のスループットを表している．
度数の高い階級がスループットの大きい方へ寄っており，高確率でスループットが比較手法より良くなることを示している．

\begin{figure}[t]
  \centering
  \includesvg[width=12cm]{histogram.svg}
  \caption{100回の実験における最良値のヒストグラム}
  \label{histogram}
\end{figure}

\section{おわりに}
% やったこと．シミュレーション結果から得られた知見．今後の課題．
本報告では，多様な端末が混在する無線LAN環境において，ベイズ最適化を用いたAP制御方式を提案した．
シミュレーションの結果から高確率でスループットが比較手法より良くなることを示した．
今後の課題として，AP台数と端末台数の増加によって入力の次元数増大がしたときに獲得関数の最大化が困難になること，端末の移動や外部からの干渉などの動的な環境変化への対応などがあげられる．

\acknowledgement
本報告を終えるにあたり，日頃よりご指導，ご教授をいただきました大阪大学情報科学研究科の若宮直紀教授に心より感謝申し上げます．ならびに，終始丁寧なご指導をいただきました大阪大学情報科学研究科の橋本匡史助教に心より御礼申し上げます. さらに本報告を作成するにあたり，様々な助言をいただきました若宮研究室の方々に深く感謝申し上げます.

\bibliographystyle{IEEEtran}
\bibliography{bibliography}
\end{document}
